<!DOCTYPE html>
<html lang="{{ site.lang | default: " en-US" }}">

<head>
  <meta charset="UTF-8">
  <title>{{ page.title | default: site.title }}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" type="text/css"
    href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">
  <link rel="stylesheet" type="text/css" href="{{ '/assets/css/custom.css' | relative_url }}">
  {% seo %}
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 1. Log to confirm the script is running
      console.log('🔍 Search script loaded and DOM is ready.');

      const searchInput = document.getElementById('search-input');
      const resultsContainer = document.getElementById('search-results');
      let fuse;

      if (!searchInput) {
        console.error('❌ Could not find search input with id="search-input"');
        return;
      }
      if (!resultsContainer) {
        console.error('❌ Could not find results container with id="search-results"');
        return;
      }

      // 2. Fetch the search index
      fetch('{{ "/search.json" | relative_url }}')
        .then(response => response.json())
        .then(data => {
          // 3. Log the data to see if it's correct
          console.log('✅ Search index fetched successfully! First item:', data[0]);

          const options = {
            keys: ['title', 'content'],
            includeScore: true,
            threshold: 0.4,
            minMatchCharLength: 2,
          };
          fuse = new Fuse(data, options);
          console.log('🚀 Fuse.js initialized.');
        })
        .catch(error => console.error('❌ Error fetching or parsing search data:', error));

      // 4. Add an event listener
      searchInput.addEventListener('input', () => {
        const query = searchInput.value;

        // 5. Log the search query
        console.log(`Searching for: "${query}"`);

        resultsContainer.innerHTML = '';

        if (query.length < 2) {
          return;
        }

        if (!fuse) {
          console.warn('Fuse.js is not yet initialized.');
          return;
        }

        const results = fuse.search(query);

        // 6. Log the results from Fuse.js
        console.log('Found results:', results);

        // 7. Display the results
        results.slice(0, 100).forEach(result => {
          const li = document.createElement('li');
          li.innerHTML = `<a href="${result.item.url}">${result.item.title}</a>`;
          resultsContainer.appendChild(li);
        });
      });
    });
  </script>


</head>

<body>
  <div class="wrapper">
    <header>
      <h1>{{ site.title | default: site.github.repository_name }}</h1>
      <p>{{ site.description | default: site.github.project_tagline }}</p>

      <!-- {% include navigation.html %} -->

    </header>
    <section>
      <div class="search-container">
        <label for="search-input" class="visually-hidden">搜索</label> <svg class="search-icon"
          xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
          stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input type="text" id="search-input" placeholder="">
        <ul id="search-results"></ul>
      </div>
      {{ content }}

    </section>
    <footer>

      <!-- {% include contact_links.html %} -->

      <p><small>欢迎贡献： <a href="https://github.com/lyxmemo">Github:lyxmemo</a></small></p>
      <p><small>贡献者：寒庭暮晚、第N个日常、长亭怨慢、杜致童、睦月、__不要着急、观棋不语、刘兴汉、sage yan、鱼珠前航道舵手</small></p>
      <p><small>小红书：建楚bot</small></p>
      <p><small>邮箱：lyxmemo@gmail.com</small></p>
      <p><small>如果有您发现有其他适合添加的文章、书籍，或者在本站文章中发现错别字，请随时邮件我～</small></p>
    </footer>
  </div>
</body>

</html>