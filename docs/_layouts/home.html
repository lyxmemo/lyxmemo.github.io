---
layout: default
title: 主页
---

<style>
  /* === “全部展开/收起”浮动按钮样式 (已恢复) === */
  .floating-toggle-wrapper {
    position: fixed;
    bottom: 30px;
    right: 30px;
    z-index: 1000;
    display: none; /* 默认隐藏，只在“分类视图”下显示 */
  }
  .floating-toggle-btn {
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid #ccc;
    color: #333;
    padding: 8px 15px;
    cursor: pointer;
    font-size: 14px;
    border-radius: 20px;
    outline: none;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    transition: all 0.2s ease-in-out;
  }
  .floating-toggle-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  }

  /* === “小测试！”浮动按钮样式 === */
  .floating-quiz-wrapper {
    position: fixed;
    bottom: 80px; /* 调整位置，避免与“全部展开/收起”按钮重叠 */
    right: 30px;
    z-index: 1000;
  }
  .floating-quiz-btn {
    background-color: #4CAF50; /* 绿色背景 */
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 25px;
    font-size: 16px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    transition: all 0.2s ease-in-out;
  }
  .floating-quiz-btn:hover {
    background-color: #45a049;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.3);
  }

  /* === 页脚的视图切换按钮样式 (低调) === */
  .footer-view-switcher {
    text-align: center;
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid #eee;
  }
  .footer-view-switcher .switch-btn {
    background: none;
    border: none;
    color: #888;
    cursor: pointer;
    font-size: 0.9rem;
    text-decoration: underline;
    padding: 5px;
    margin: 0 10px;
  }
  .footer-view-switcher .switch-btn:hover {
    color: #007bff;
  }
  .footer-view-switcher .switch-btn.active {
    color: #333;
    font-weight: bold;
    text-decoration: none;
    cursor: default;
  }

  /* --- 分类视图内部的样式 --- */
  /* Tab 样式 */
  .tab { overflow: hidden; border-bottom: 1px solid #ddd; }
  .tab button { background-color: transparent; float: left; border: none; outline: none; cursor: pointer; padding: 0.7rem 1rem; transition: background-color 0.3s; font-size: 1rem; color: #555; border-radius: 6px 6px 0 0; }
  .tab button:hover:not(.active) { background-color: #f1f1f1; }
  .tab button.active { background-color: #e9e9e9; font-weight: bold; color: #333; }
  .tabcontent { display: none; padding: 0px 0; animation: fadeEffect 0.5s; }
  @keyframes fadeEffect { from {opacity: 0;} to {opacity: 1;} }

  /* 可折叠列表样式 */
  .collapsible-book { border-bottom: 1px solid #e0e0e0; }
  .collapsible-book:first-of-type { border-top: 1px solid #e0e0e0; }
  summary { font-size: 1rem; font-weight: 600; padding: 0.5rem 0px; cursor: pointer; list-style: none; outline: none; margin-bottom:0!important; transition: background-color 0.2s; color: #504949ff; }
  summary:hover { background-color: #f7f7f7; }
  summary::-webkit-details-marker { display: none; }
  summary::before { content: '−'; font-family: monospace; font-weight: bold; font-size: 1rem; margin-right: 12px; color: #888; display: inline-block; width: 20px; text-align: center; }
  details:not([open]) > summary::before { content: '+'; }
  .collapsible-book ul { list-style-type: none; padding: 10px 0 15px 42px; margin: 0; }
  .collapsible-book li { padding: 0.1rem 0; border: none; }

  /* 时间线视图的样式 */
  .timeline-list { list-style-type: none; padding-left: 0; }
  .timeline-list li, .timeline-list-no-date li { display: flex; align-items: baseline; padding: 0.2rem 0; }
  /* .timeline-list li { border-bottom: 1px solid #eee; } 电报Tab带下划线 */
  /* .timeline-list-no-date li { border-bottom: none; } 时间线Tab不带下划线 */
  .timeline-date { margin: 0 1rem; flex-shrink: 0; font-size: 0.8rem; }
  .unknown-date-header { margin-top: 40px; padding-top: 20px; border-top: 2px solid #ccc; font-size: 1rem; font-weight: bold; color: #555; }
</style>

<div class="floating-toggle-wrapper">
  <button class="floating-toggle-btn" onclick="toggleAllMaster('#new-view .collapsible-book')">全部展开/收起</button>
</div>

<div class="floating-quiz-wrapper">
  <button class="floating-quiz-btn" onclick="window.location.href='{{ '/quiz/index.html' | relative_url }}'">小测试！</button>
</div>

<div id="new-view" class="view-panel">
  {%- assign memorial_posts_raw = "" | split: "" -%}
  {%- assign telegrams_raw = "" | split: "" -%}
  {%- assign magazines_raw = "" | split: "" -%}
  {%- assign collections_to_search = "liaos_writings,ten_year_memorial,n6a_memorial,n22d_memorial,battles_history,liaos_tele,newspapers" | split: "," -%}
  {%- for collection_name in collections_to_search -%}
    {%- for post in site[collection_name] -%}
      {%- if post.category == "Liao's Tele" -%}{%- assign telegrams_raw = telegrams_raw | push: post -%}{%- elsif post.category == "报刊杂志" -%}{%- assign magazines_raw = magazines_raw | push: post -%}{%- else -%}{%- assign memorial_posts_raw = memorial_posts_raw | push: post -%}{%- endif -%}
    {%- endfor -%}
  {%- endfor -%}

  <div class="tab">
    <button class="tablinks" onclick="openTab(event, 'byBook')" id="byBook-tab">按书籍</button>
    <button class="tablinks" onclick="openTab(event, 'byTime')" id="byTime-tab">按时间</button>
    <button class="tablinks" onclick="openTab(event, 'telegrams')" id="telegrams-tab">电报</button>
    <button class="tablinks" onclick="openTab(event, 'magazines')" id="magazines-tab">报刊杂志</button>
  </div>
  
  <div id="byBook" class="tabcontent">
    {%- if memorial_posts_raw and memorial_posts_raw.size > 0 -%}
      {%- assign posts_by_book = memorial_posts_raw | group_by: "category" -%}
      {%- for book in posts_by_book -%}
        <details class="collapsible-book" open>
          <summary>《{{ book.name }}》</summary>
          <ul>
            {%- assign items_sorted_by_title = book.items | sort: 'title' -%}
            {%- for post in items_sorted_by_title -%}<li><a href="{{ post.url | relative_url }}">{{ post.title }}</a>{%- if post.author -%}（{{ post.author }}）{%- endif -%}</li>{%- endfor -%}
          </ul>
        </details>
      {%- endfor -%}
    {%- else -%}<p>未能生成列表。</p>{%- endif -%}
  </div>

  <div id="byTime" class="tabcontent">
    {%- assign timeline_posts = memorial_posts_raw | concat: magazines_raw -%}
    {%- if timeline_posts and timeline_posts.size > 0 -%}
      {%- assign dated_posts = "" | split: "" -%}{%- assign undated_posts = "" | split: "" -%}
      {%- for post in timeline_posts -%}{%- assign formatted_date = post.date | date: "%Y-%m-%d" -%}{%- if formatted_date == "1900-01-01" or post.date == nil -%}{%- assign undated_posts = undated_posts | push: post -%}{%- else -%}{%- assign dated_posts = dated_posts | push: post -%}{%- endif -%}{%- endfor -%}
      {%- if dated_posts.size > 0 -%}
        {%- assign posts_by_year = dated_posts | group_by_exp: "post", "post.date | date: '%Y'" | sort: "name" | reverse -%}
        {%- for year_group in posts_by_year -%}
          <details class="collapsible-book" open>
            <summary>{{ year_group.name }} 年</summary>
            <ul class="timeline-list-no-date">
              {%- assign posts_in_year = year_group.items | sort: 'date' | reverse -%}
              {%- for post in posts_in_year -%}<li><a href="{{ post.url | relative_url }}">{{ post.title }}</a>{%- if post.author -%}（{{ post.author }}）{%- endif -%}</li>{%- endfor -%}
            </ul>
          </details>
        {%- endfor -%}
      {%- endif -%}
      {%- if undated_posts.size > 0 -%}<h3 class="unknown-date-header">暂无时间</h3><ul>{%- assign undated_posts_sorted = undated_posts | sort: 'title' -%}{%- for post in undated_posts_sorted -%}<li><a href="{{ post.url | relative_url }}">{{ post.title }}</a>{%- if post.author -%}（{{ post.author }}）{%- endif -%}</li>{%- endfor -%}</ul>{%- endif -%}
    {%- else -%}<p>未能生成列表。</p>{%- endif -%}
  </div>
  
  <div id="telegrams" class="tabcontent">
    {%- assign telegrams = telegrams_raw | sort: 'date' -%}
    {%- if telegrams.size > 0 -%}
      {%- assign periods = "" | split: "," -%}
      {%- assign p1 = "end_date:1938-02-26|title:【教导总队中校参谋主任】南京保卫战" | split: "|" -%}
      {%- assign p2 = "start_date:1938-02-26|end_date:1942-01-01|title:【新二二师副师长】桂南会战" | split: "|" -%}
      {%- assign p3 = "start_date:1942-01-01|end_date:1942-05-16|title:【新二二师师长】第一次入缅作战" | split: "|" -%}
      {%- assign p4 = "start_date:1942-05-16|end_date:1942-10-01|title:【新二二师师长】徒步野人山" | split: "|" -%}
      {%- assign p5 = "start_date:1942-10-01|end_date:1943-11-01|title:【新二二师师长】驻印军整训" | split: "|" -%}
      {%- assign p6 = "start_date:1943-11-01|end_date:1944-09-01|title:【新二二师师长】缅北胜利反攻（胡康河谷）" | split: "|" -%}
      {%- assign p7 = "start_date:1944-09-01|end_date:1945-01-01|title:【新六军军长】缅北胜利反攻（八莫、腊戌）" | split: "|" -%}
      {%- assign p8 = "start_date:1945-01-01|end_date:1945-05-01|title:【新六军军长】云南曲靖整训待命" | split: "|" -%}
      {%- assign p9 = "start_date:1945-05-01|end_date:1945-08-15|title:【新六军军长】湘西反攻" | split: "|" -%}
      {%- assign p10 = "start_date:1945-08-15|end_date:1946-01-01|title:【新六军军长】驻防京沪" | split: "|" -%}
      {%- assign p11 = "start_date:1946-01-01|end_date:1947-01-01|title:【新六军军长】东北攻势作战" | split: "|" -%}
      {%- assign p12 = "start_date:1947-01-01|end_date:1948-01-01|title:【第四兵团司令官】东北解围作战" | split: "|" -%}
      {%- assign p13 = "start_date:1948-01-01|end_date:1949-01-01|title:【第九兵团司令官】东北撤退作战" | split: "|" -%}
      {%- assign periods = periods | push: p1 | push: p2 | push: p3 | push: p4 | push: p5 | push: p6 | push: p7 | push: p8 | push: p9 | push: p10 | push: p11 | push: p12 | push: p13 -%}

      {%- for period in periods -%}
        {%- assign start_date = nil -%}
        {%- assign end_date = nil -%}
        {%- assign title = nil -%}
        {%- for prop_str in period -%}
          {%- assign prop_key = prop_str | split: ":" | first -%}
          {%- assign prop_value = prop_str | split: ":" | slice: 1 | join: ":" -%}
          {%- if prop_key == "start_date" -%}
            {%- assign start_date = prop_value -%}
          {%- elsif prop_key == "end_date" -%}
            {%- assign end_date = prop_value -%}
          {%- elsif prop_key == "title" -%}
            {%- assign title = prop_value -%}
          {%- endif -%}
        {%- endfor -%}

        {%- assign posts_in_period = "" | split: "," -%}
        {%- for post in telegrams -%}
          {%- assign post_date = post.date | date: "%Y-%m-%d" -%}
          {%- if start_date == nil and post_date < end_date -%}{%- assign posts_in_period = posts_in_period | push: post -%}{%- endif -%}
          {%- if start_date and post_date >= start_date and post_date < end_date -%}{%- assign posts_in_period = posts_in_period | push: post -%}{%- endif -%}
        {%- endfor -%}

        {%- if posts_in_period.size > 0 -%}
          <details class="collapsible-book" open>
            <summary>{{ title }}</summary>
            <ul class="timeline-list">
              {%- for post in posts_in_period -%}
              <li>
                <span class="timeline-date">{{ post.date | date: "%Y-%m-%d" }}</span>
                <div>{%- assign title_parts = post.title | split: ']' -%}{%- if title_parts.size > 1 -%}{%- assign bracket_prefix = title_parts[0] | append: ']' -%}{%- assign after_prefix = title_parts[1] -%}{%- assign first_char = after_prefix | slice: 0 -%}{%- if first_char == '1' or first_char == '2' -%}{%- assign rest_of_title = after_prefix | slice: 10, 999 -%}{%- assign title_to_display = bracket_prefix | append: rest_of_title -%}{%- else -%}{%- assign title_to_display = bracket_prefix | append: after_prefix -%}{%- endif -%}{%- else -%}{%- assign first_char = post.title | slice: 0 -%}{%- if first_char == '1' or first_char == '2' -%}{%- assign title_to_display = post.title | slice: 10, 999 -%}{%- else -%}{%- assign title_to_display = post.title -%}{%- endif -%}{%- endif -%}<a href="{{ post.url | relative_url }}">{{ title_to_display }}</a></div>
              </li>
              {%- endfor -%}
            </ul>
          </details>
        {%- endif -%}
      {%- endfor -%}
    {%- else -%}<p>未能生成列表。请检查 `category` 为 `Liao's Tele` 的文章是否存在。</p>{%- endif -%}
  </div>

  <div id="magazines" class="tabcontent">
    {%- if magazines_raw and magazines_raw.size > 0 -%}
      {%- assign dated_magazines = "" | split: "" -%}
      {%- assign undated_magazines = "" | split: "" -%}
      {%- for post in magazines_raw -%}
        {%- assign formatted_date = post.date | date: "%Y-%m-%d" -%}
        {%- if formatted_date == "1900-01-01" or post.date == nil -%}
          {%- assign undated_magazines = undated_magazines | push: post -%}
        {%- else -%}
          {%- assign dated_magazines = dated_magazines | push: post -%}
        {%- endif -%}
      {%- endfor -%}

      {%- assign dated_magazines_sorted = dated_magazines | sort: 'date' -%}
      {%- if dated_magazines_sorted.size > 0 -%}
        {%- assign periods = "" | split: "," -%}
        {%- assign p1 = "end_date:1938-02-26|title:【教导总队中校参谋主任】南京保卫战" | split: "|" -%}
        {%- assign p2 = "start_date:1938-02-26|end_date:1942-01-01|title:【新二二师副师长】桂南会战" | split: "|" -%}
        {%- assign p3 = "start_date:1942-01-01|end_date:1942-05-16|title:【新二二师师长】第一次入缅作战" | split: "|" -%}
        {%- assign p4 = "start_date:1942-05-16|end_date:1942-10-01|title:【新二二师师长】徒步野人山" | split: "|" -%}
        {%- assign p5 = "start_date:1942-10-01|end_date:1943-11-01|title:【新二二师师长】驻印军整训" | split: "|" -%}
        {%- assign p6 = "start_date:1943-11-01|end_date:1944-09-01|title:【新二二师师长】缅北胜利反攻（胡康河谷）" | split: "|" -%}
        {%- assign p7 = "start_date:1944-09-01|end_date:1945-01-01|title:【新六军军长】缅北胜利反攻（八莫、腊戌）" | split: "|" -%}
        {%- assign p8 = "start_date:1945-01-01|end_date:1945-05-01|title:【新六军军长】云南曲靖整训待命" | split: "|" -%}
        {%- assign p9 = "start_date:1945-05-01|end_date:1945-08-15|title:【新六军军长】湘西反攻" | split: "|" -%}
        {%- assign p10 = "start_date:1945-08-15|end_date:1946-01-01|title:【新六军军长】驻防京沪" | split: "|" -%}
        {%- assign p11 = "start_date:1946-01-01|end_date:1947-01-01|title:【新六军军长】东北攻势作战" | split: "|" -%}
        {%- assign p12 = "start_date:1947-01-01|end_date:1948-01-01|title:【第四兵团司令官】东北解围作战" | split: "|" -%}
        {%- assign p13 = "start_date:1948-01-01|end_date:1949-01-01|title:【第九兵团司令官】东北撤退作战" | split: "|" -%}
        {%- assign periods = periods | push: p1 | push: p2 | push: p3 | push: p4 | push: p5 | push: p6 | push: p7 | push: p8 | push: p9 | push: p10 | push: p11 | push: p12 | push: p13 -%}

        {%- for period in periods -%}
          {%- assign start_date = nil -%}
          {%- assign end_date = nil -%}
          {%- assign title = nil -%}
          {%- for prop_str in period -%}
            {%- assign prop_key = prop_str | split: ":" | first -%}
            {%- assign prop_value = prop_str | split: ":" | slice: 1 | join: ":" -%}
            {%- if prop_key == "start_date" -%}
              {%- assign start_date = prop_value -%}
            {%- elsif prop_key == "end_date" -%}
              {%- assign end_date = prop_value -%}
            {%- elsif prop_key == "title" -%}
              {%- assign title = prop_value -%}
            {%- endif -%}
          {%- endfor -%}

          {%- assign posts_in_period = "" | split: "," -%}
          {%- for post in dated_magazines_sorted -%}
            {%- assign post_date = post.date | date: "%Y-%m-%d" -%}
            {%- if start_date == nil and post_date < end_date -%}{%- assign posts_in_period = posts_in_period | push: post -%}{%- endif -%}
            {%- if start_date and post_date >= start_date and post_date < end_date -%}{%- assign posts_in_period = posts_in_period | push: post -%}{%- endif -%}
          {%- endfor -%}

          {%- if posts_in_period.size > 0 -%}
            <details class="collapsible-book" open>
              <summary>{{ title }}</summary>
              <ul class="timeline-list">
                {%- for post in posts_in_period -%}
                  <li>
                    <span class="timeline-date">{{ post.date | date: "%Y-%m-%d" }}</span>
                    <div><a href="{{ post.url | relative_url }}">{{ post.title }}</a>{%- if post.author -%}（{{ post.author }}）{%- endif -%}</div>
                  </li>
                {%- endfor -%}
              </ul>
            </details>
          {%- endif -%}
        {%- endfor -%}
      {%- endif -%}

      {%- if undated_magazines.size > 0 -%}
        <details class="collapsible-book" open>
          <summary>日期未知</summary>
          <ul class="timeline-list-no-date">
            {%- assign undated_magazines_sorted = undated_magazines | sort: 'title' -%}
            {%- for post in undated_magazines_sorted -%}
              <li><a href="{{ post.url | relative_url }}">{{ post.title }}</a>{%- if post.author -%}（{{ post.author }}）{%- endif -%}</li>
            {%- endfor -%}
          </ul>
        </details>
      {%- endif -%}
    {%- else -%}
      <p>未能生成列表。</p>
    {%- endif -%}
  </div>
</div>

<div id="original-view" class="view-panel">
  <div class="home">
    {% assign custom_order = "liaos_writings,ten_year_memorial,n6a_memorial,n22d_memorial,battles_history,liaos_tele,newspapers" | split: "," %}
    {% for category_name in custom_order %}{% assign collection_data = site.collections | where: "label", category_name | first %}{% if category_name == "liaos_tele" %}<details><summary><h2>{{ collection_data.display_name }}</h2></summary><ul>{% else %}{% if collection_data.display_name %}<h2>{{ collection_data.display_name }}</h2>{% else %}<h2>{{ category_name | replace: "_", " " | capitalize }}</h2>{% endif %}<ul>{% endif %}{% if category_name == "battles_history" %}{% assign year_folders = "1942,1943,1944,1945,1946,1947,1948" | split: "," %}{% for year in year_folders %}{% assign posts_in_year = site[category_name] | where_exp: "post", "post.path contains year" %}{% if posts_in_year.size > 0 %}<li><h3 class="sub-heading">{{ year }}</h3><ul>{% for post in posts_in_year %}<li><a href="{{ post.url | relative_url }}">{{ post.title }}</a></li>{% endfor %}</ul></li>{% endif %}{% endfor %}{% else %}{% assign posts_in_category = site[category_name] | sort: "title" %}{% for post in posts_in_category %}<li><a href="{{ post.url | relative_url }}">{{ post.title }}</a></li>{% endfor %}{% endif %}</ul>{% if category_name == "liaos_tele" %}</details>{% endif %}{% endfor %}
  </div>
</div>

<br/>

<h2>资料下载区</h2>
<ul>{% for file in site.static_files %}{% if file.path contains 'resources' %}<li><a href="https://github.com/lyxmemo/lyxmemo.github.io/raw/refs/heads/main/docs/resources/{{ file.basename | uri_escape }}.pdf">下载：{{ file.basename }}</a></li>{% endif %}{% endfor %}</ul>


<div class="footer-view-switcher">
  <button class="switch-btn" onclick="switchView('new-view', this)">分类视图</button>
  <button class="switch-btn" onclick="switchView('original-view', this)">原始首页</button>
</div>


<script>
  // --- 视图切换功能 ---
  function switchView(viewId, clickedButton) {
    var toggleButton = document.querySelector('.floating-toggle-wrapper');
    document.querySelectorAll('.view-panel').forEach(panel => { panel.style.display = 'none'; });
    document.querySelectorAll('.footer-view-switcher .switch-btn').forEach(btn => { btn.classList.remove('active'); });
    document.getElementById(viewId).style.display = 'block';
    clickedButton.classList.add('active');
    if (viewId === 'new-view') { toggleButton.style.display = 'block'; } else { toggleButton.style.display = 'none'; }
  }

  // --- Tab 切换功能 ---
  function openTab(evt, tabName) {
    var i, tabcontent, tablinks;
    var tabContainer = document.getElementById('new-view');
    tabcontent = tabContainer.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) { tabcontent[i].style.display = "none"; }
    tablinks = tabContainer.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) { tablinks[i].className = tablinks[i].className.replace(" active", ""); }
    document.getElementById(tabName).style.display = "block";
    if (evt) { evt.currentTarget.className += " active"; }
    localStorage.setItem('lastTab', tabName);
  };

  // --- 全部展开/收起功能 ---
  function toggleAllMaster(selector) {
    const detailsElements = document.querySelectorAll(selector);
    if (detailsElements.length === 0) { return; }
    const hasAClosedElement = Array.from(detailsElements).some(detail => !detail.open);
    const newState = hasAClosedElement;
    detailsElements.forEach((detail) => { detail.open = newState; });
  };

  // --- 页面加载时执行的默认操作 ---
  document.addEventListener('DOMContentLoaded', () => {
    // 默认切换到“分类视图”
    document.querySelector('.footer-view-switcher .switch-btn').click();

    const openTabFromHash = () => {
      const hash = window.location.hash.substring(1);
      const validTabs = ['byBook', 'byTime', 'telegrams', 'magazines'];
      let tabToOpen = '';

      if (hash && validTabs.includes(hash)) {
        tabToOpen = hash;
      } else {
        const lastTab = localStorage.getItem('lastTab');
        if (lastTab && validTabs.includes(lastTab)) {
          tabToOpen = lastTab;
        } else {
          tabToOpen = 'byBook';
        }
      }
      
      const tabButton = document.getElementById(tabToOpen + '-tab');
      if (tabButton) {
        tabButton.click();
      } else {
        document.getElementById('byBook-tab').click(); // Fallback
      }
    };

    openTabFromHash();
    window.addEventListener('hashchange', openTabFromHash, false);
  });
</script>
